# 2. 요구사항

## 1. 핵심 기능 요구사항

### 1.1. 대기열 시스템
- **토큰 발급 API**: 사용자가 서비스 이용을 위한 고유 대기열 토큰을 발급받음
- **토큰 구성**: 유저 UUID, 대기 순번, 상태 정보(대기중/활성화) 포함
- **접근 제어**: 활성화된 토큰을 가진 사용자만 핵심 API 호출 가능
- **대기열 관리**: 요청 순서에 따라 공정하게 사용자를 활성화 상태로 전환

### 1.2. 좌석 조회
- **날짜 조회 API**: 예약 가능한 콘서트 날짜 목록 제공
- **좌석 조회 API**: 특정 날짜 선택 시 예약 가능한 좌석 목록(1~50번) 및 상태 조회
- **실시간 상태**: 좌석별 상태(예약 가능/임시 배정/판매 완료)를 정확히 반영

### 1.3. 좌석 예약
- **예약 요청 API**: 날짜와 좌석 번호를 입력받아 예약 처리
- **임시 배정**: 예약 시 해당 좌석은 5분간 임시 배정 상태로 전환
- **동시성 제어**: 이미 임시 배정된 좌석은 다른 사용자가 예약 불가
- **자동 만료**: 5분 내 결제 미완료 시 좌석의 임시 배정 상태 자동 해제

### 1.4. 잔액 관리
- **잔액 충전 API**: 사용자 계정에 금액 충전
- **잔액 조회 API**: 현재 사용자의 잔액 확인

### 1.5. 결제
- **결제 API**: 임시 배정된 좌석에 대해 잔액으로 결제 처리
- **상태 변경**: 결제 성공 시 좌석은 '판매 완료' 상태로 변경
- **토큰 관리**: 결제 완료 시 사용자의 대기열 토큰 만료 처리

## 2. 기술 요구사항

### 2.1. 아키텍처 및 설계
- **헥사고날 아키텍처** 적용
- **도메인 모델** 중심의 설계

### 2.2. 분산 환경 대응
- **다수 인스턴스 지원**: 여러 서버에서 동시 실행되어도 정상 동작
- **상태 공유**: Redis를 통한 분산 환경에서의 상태 공유

### 2.3. 동시성 제어
- **분산 락 구현**: Redis 기반 분산 락을 통한 동시성 제어
- **원자적 연산**: 동시 요청 처리 시 데이터 일관성 보장

### 2.4. 테스트
- **단위 테스트**: 핵심 기능별 최소 1개 이상의 테스트 코드 작성
- **통합 테스트**: 주요 시나리오에 대한 통합 테스트 구현

## 3. API 명세 요약

| API | 엔드포인트 | 메서드 | 주요 기능 | 우선순위 |
|-----|------------|--------|----------|---------|
| **토큰 발급** | `/api/tokens` | POST | 대기열 토큰 발급 | 높음 |
| **날짜 조회** | `/api/concerts/dates` | GET | 예약 가능 날짜 목록 조회 | 중간 |
| **좌석 조회** | `/api/concerts/{scheduleId}/seats` | GET | 특정 날짜 좌석 목록 조회 | 중간 |
| **좌석 예약** | `/api/reservations` | POST | 좌석 임시 예약 처리 | 높음 |
| **잔액 충전** | `/api/users/balance` | PATCH | 사용자 잔액 충전 | 중간 |
| **잔액 조회** | `/api/users/balance` | GET | 사용자 잔액 조회 | 중간 |
| **결제 처리** | `/api/payments` | POST | 좌석 결제 및 확정 | 높음 |

## 4. 제약 조건

- **토큰 검증**: 모든 API는 토큰 발급 API를 제외하고 대기열 토큰 검증 필요
- **동시성 제어**: 동일 좌석에 대한 동시 예약 요청 처리 시 중복 방지
- **임시 배정 시간**: 좌석 예약 후 5분 이내 결제 필요
- **대기열 공정성**: 먼저 요청한 사용자부터 서비스 이용 기회 제공
