# 7. 테스트·QA 전략

## 1. 단위 테스트 (Unit Test)
-   요구사항에 명시된 바와 같이, 각 기능 및 제약사항에 대해 Junit5, Mockito 등을 활용하여 단위 테스트를 작성합니다.
-   **테스트 대상:**
    -   대기열 토큰 생성 및 검증 로직
    -   좌석 상태 변경 로직 (AVAILABLE -> RESERVED -> SOLD)
    -   잔액 충전 및 차감 로직
    -   예약 만료 로직
    -   각 API의 Controller, Service, Repository 계층별 기능

## 2. 통합 테스트 (Integration Test)
-   실제 DB와 Redis 환경(또는 Testcontainers를 이용한 가상 환경)을 연동하여 API의 전체 흐름을 테스트합니다.
-   **주요 시나리오:**
    1.  토큰 발급 -> 좌석 조회 -> 좌석 예약 -> 결제까지 이어지는 성공적인 Happy Path 시나리오.
    2.  예약 후 결제하지 않아 만료되는 시나리오.
    3.  잔액 부족으로 결제 실패하는 시나리오.

## 3. 동시성 테스트 (Concurrency Test)
-   이 프로젝트의 핵심적인 품질 보증 활동입니다.
-   **도구:** `nGrinder`, `JMeter`, `k6` 등 부하 테스트 도구를 사용합니다.
-   **테스트 시나리오:**
    -   **좌석 중복 예약 테스트:** 다수의 가상 유저(e.g., 100명)가 **동일한 좌석**에 대해 동시에 예약 요청 API를 보내도록 설정합니다.
    -   **검증:** 테스트 종료 후, DB를 확인하여 해당 좌석이 단 한 건의 예약/결제로만 처리되었는지 검증합니다. `409 Conflict` 응답이 예상대로 반환되었는지 로그를 통해 확인합니다.
    -   **대기열 시스템 테스트:** 수천 개의 토큰 발급 요청을 동시에 보내 대기열 시스템이 요청을 순서대로 처리하고 서버 부하를 효과적으로 제어하는지 모니터링합니다.

## 4. 성능 테스트
-   **목적:** 시스템이 목표 TPS(Transaction Per Second)를 달성할 수 있는지 검증합니다.
-   **주요 측정 지표:**
    -   응답 시간 (Response Time): 요청에 대한 응답까지 걸리는 시간
    -   처리량 (Throughput): 단위 시간당 처리 가능한 요청 수
    -   리소스 사용률: CPU, 메모리, 네트워크 등 시스템 자원 사용 현황

## 5. 회복성 테스트 (Resilience Test)
-   **목적:** 시스템의 일부가 실패하더라도 전체 시스템이 정상적으로 동작하는지 검증합니다.
-   **시나리오:**
    -   Redis 서버 일시적 다운 상황에서의 시스템 동작 테스트
    -   여러 애플리케이션 인스턴스 중 일부가 다운된 상황에서의 시스템 동작 테스트
    -   DB 연결 지연 상황에서의 시스템 동작 테스트

## 6. 자동화 테스트 파이프라인
-   CI/CD 파이프라인에 테스트 단계를 통합하여 코드 변경 시마다 자동으로 테스트를 실행합니다.
-   **순서:**
    1. 단위 테스트 실행
    2. 통합 테스트 실행
    3. 코드 품질 검사 (SonarQube 등)
    4. 필요 시 동시성 테스트 실행 (별도 환경에서)
