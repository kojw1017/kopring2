# 1. 문제 정의 & 목표

## 1. 문제 정의

인기 콘서트 티켓 예약 시 발생하는 주요 문제점:

- **트래픽 폭주**: 티켓 오픈 시 서버가 다운되는 현상
- **불공정한 접근**: 빠른 클릭이나 새로고침에 의존하는 방식으로 인한 불공정성
- **좌석 중복 예약**: 동시에 여러 사용자가 같은 좌석을 선택할 때 발생하는 데이터 일관성 문제
- **사용자 경험 저하**: 결제 과정에서 좌석이 사라지는 등의 불편한 경험

## 2. 프로젝트 목표

이 사이드 프로젝트는 다음 목표를 달성하고자 합니다:

### 2.1 기능적 목표

- **대기열 시스템 구현**: Redis Sorted Set을 활용한 공정한 대기열 시스템 구축
- **동시성 제어**: Redis 분산 락을 통한 좌석 중복 예약 방지
- **임시 예약 관리**: 좌석 임시 배정 및 자동 만료 메커니즘 구현
- **결제 시스템**: 사용자 잔액 관리 및 결제 처리

### 2.2 기술적 목표

- **헥사고날 아키텍처 적용**: 도메인 모델 격리와 테스트 가능한 설계
- **분산 환경 대응**: 여러 서버 인스턴스에서도 정합성 보장
- **테스트 주도 개발**: 주요 비즈니스 로직에 대한 단위 테스트 작성

### 2.3 학습 목표

- Redis를 활용한 분산 시스템 설계 및 구현 경험
- 동시성 제어 메커니즘 이해 및 적용
- 헥사고날 아키텍처와 도메인 주도 설계 실습
- 실제 서비스에서 발생할 수 있는 트래픽 관리 전략 학습

## 3. 핵심 구현 우선순위

1. **대기열 시스템**: 부하 분산과 공정한 접근 보장
2. **동시성 제어**: 좌석 중복 예약 방지
3. **데이터 정합성**: 예약과 결제 간의 일관된 상태 관리
4. **단위 테스트**: 핵심 비즈니스 로직 검증

## 4. 성공 기준

- **동시 요청 처리**: 동시에 들어오는 다수의 좌석 예약 요청을 정확히 처리
- **대기열 공정성**: 선착순 기반의 공정한 대기열 관리
- **테스트 커버리지**: 핵심 비즈니스 로직에 대한 단위 테스트 확보
- **코드 품질**: 헥사고날 아키텍처 원칙 준수

<aside>
💡 아래 명세를 잘 읽어보고, 서버를 구현합니다.

</aside>

## Description

- **`콘서트 예약 서비스`**를 구현해 봅니다.
- 대기열 시스템을 구축하고, 예약 서비스는 작업가능한 유저만 수행할 수 있도록 해야합니다.
- 사용자는 좌석예약 시에 미리 충전한 잔액을 이용합니다.
- 좌석 예약 요청시에, 결제가 이루어지지 않더라도 일정 시간동안 다른 유저가 해당 좌석에 접근할 수 없도록 합니다.

## Requirements

- 아래 5가지 API 를 구현합니다.
    - 유저 토큰 발급 API
    - 예약 가능 날짜 / 좌석 API
    - 좌석 예약 요청 API
    - 잔액 충전 / 조회 API
    - 결제 API
- 각 기능 및 제약사항에 대해 단위 테스트를 반드시 하나 이상 작성하도록 합니다.
- 다수의 인스턴스로 어플리케이션이 동작하더라도 기능에 문제가 없도록 작성하도록 합니다.
- 동시성 이슈를 고려하여 구현합니다.
- 대기열 개념을 고려해 구현합니다.

## API Specs

1️⃣ **`주요` 유저 대기열 토큰 기능**

- 서비스를 이용할 토큰을 발급받는 API를 작성합니다.
- 토큰은 유저의 UUID 와 해당 유저의 대기열을 관리할 수 있는 정보 ( 대기 순서 or 잔여 시간 등 ) 를 포함합니다.
- 이후 대기열에 의해 **보호받는** 모든 API 는 위 토큰을 이용해 대기열 검증을 통과해야 이용 가능합니다.
- **내 대기번호를 조회하는 폴링용 API를 작성합니다.**

> 기본적으로 폴링으로 본인의 대기열을 확인한다고 가정하며, 다른 방안 또한 고려해보고 구현해 볼 수 있습니다.
>

**2️⃣ `기본` 예약 가능 날짜 / 좌석 API**

- 예약가능한 날짜와 해당 날짜의 좌석을 조회하는 API 를 각각 작성합니다.
- 예약 가능한 날짜 목록을 조회할 수 있습니다.
- 날짜 정보를 입력받아 예약가능한 좌석정보를 조회할 수 있습니다.

> 좌석 정보는 1 ~ 50 까지의 좌석번호로 관리됩니다.
>

3️⃣ **`주요` 좌석 예약 요청 API**

- 날짜와 좌석 정보를 입력받아 좌석을 예약 처리하는 API 를 작성합니다.
- 만약 배정 시간 내에 결제가 완료되지 않는다면 좌석에 대한 임시 배정은 해제되어야 하며 임시배정 상태의 좌석에 대해 다른 사용자는 예약할 수 없어야 한다.

4️⃣ **`기본`**  **잔액 충전 / 조회 API**

- 결제에 사용될 금액을 API 를 통해 충전하는 API 를 작성합니다.
- 사용자 식별자 및 충전할 금액을 받아 잔액을 충전합니다.
- 사용자 식별자를 통해 해당 사용자의 잔액을 조회합니다.

5️⃣ **`주요` 결제 API**

- 결제 처리하고 결제 내역을 생성하는 API 를 작성합니다.
- 결제가 완료되면 해당 좌석의 소유권을 유저에게 배정하고 대기열 토큰을 만료시킵니다.

<aside>
💡 **KEY POINT**

</aside>

- 유저간 대기열을 요청 순서대로 정확하게 제공할 방법을 고민해 봅니다.
- 동시에 여러 사용자가 예약 요청을 했을 때, 좌석이 중복으로 배정 가능하지 않도록 합니다.

<aside>
🗓️ **Weekly Schedule Summary: 이번 챕터의 주간 일정 (금요일 오전 10시까지 제출)**

</aside>

### 4주차 과제

### **`DEFAULT`**

- 각 시나리오별 하기 **비즈니스 로직** 개발 및 **단위 테스트** 작성
    - `e-commerce` : 상품 조회, 주문/결제 기능
    - `concert` : 대기열 발급, 대기순번 조회, 좌석 예약 기능

> **단위 테스트** 는 반드시 대상 객체/기능 에 대한 의존성만 존재해야 함
>

### **`STEP07`**

- API Swagger 기능 구현 및 캡쳐본 첨부 ( Readme )
- 주요 비즈니스 로직 개발 및 단위 테스트 작성

### **`STEP08`**

- 비즈니스 Usecase 개발 및 통합 테스트 작성

> API 의 완성이 목표가 아닌, 기본 및 주요 기능의 비즈니스 로직 및 유즈케이스는 구현이 완료 되어야 함. ( `Business Layer` )
>

> DB Index , 대용량 처리를 위한 개선 포인트 등은 추후 챕터에서 진행하므로 목표는 `기능 개발의 완료` 로 합니다. 최적화 작업 등을 고려하는 것 보다 모든 기능을 정상적으로 제공할 수 있도록 해주세요. 특정 기능을 왜 이렇게 개발하였는지 합당한 이유와 함께 기능 개발을 진행해주시면 됩니다.
>
